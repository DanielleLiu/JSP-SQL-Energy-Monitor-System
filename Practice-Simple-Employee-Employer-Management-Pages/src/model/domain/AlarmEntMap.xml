<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"

    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sbzy.enterpriseems.model.domain.AlarmEnt">
    <resultMap type="alarment" id="AlarmEntMap">
        <id property="id" column="ID"/>
        <result property="kpiid" column="KPIID"/>
         <result property="entenergyid" column="EntEnergyID"/>
         <result property="basevalue" column="BaseValue" />
		<result property="isstandard" column="isStandard" />
		<result property="datecycle" column="DateCycle" />
		
         <association property="alarmkpi" column="KPIID" select="selkipname">
         	  <id property="ID" column="ID"/>
       	 	  <result property="ParaID" column="ParaID"/>
       	 	  <result property="Name" column="Name"/>
         	  <result property="BeginTime" column="BeginTime"/>
      		  <result property="StopTime" column="StopTime"/>
         </association>
         <association property="entenergy" column="EntEnergyID" select="selregionname">
         </association>
    </resultMap>
<select id="selkipname" resultType="sbzy.enterpriseems.model.domain.EnergyAlarmKPI" parameterType="int">
select * from EnergyAlarmKPI where id=#{kpiid}
</select>
<select id="selregionname" resultType="entenergy" parameterType="int">
select * from EntEnergy where id=#{EntEnergyID}
</select>
<select id="selalarbycmpname" resultMap="AlarmEntMap" parameterType="java.util.HashMap">
select * from AlarmEnt where EntID in (select ID from EnergyCconsumptionUnit where CompanyName LIKE '%'+#{regionname}+'%'
</select>

    <insert id="insert" parameterType="AlarmEnt">
     <![CDATA[
            insert into AlarmEnt (KPIID ,EntEnergyID,BaseValue,isStandard,DateCycle)
            values(#{kpiid},#{entenergyid},#{basevalue},#{isstandard},#{datecycle})
        ]]>
    </insert>
    <!-- 更新数据 -->
    <update id="update" parameterType="AlarmEnt">
     <![CDATA[
            update AlarmEnt set KPIID=#{kpiid},EntEnergyID=#{entenergyid},BaseValue=#{basevalue},isStandard=#{isstandard},DateCycle=#{datecycle}
            where ID=#{id}
        ]]>
    </update>
    <!-- 删除数据 -->
    <delete id="delete" parameterType="int">
    <![CDATA[
            delete  from AlarmEnt where ID=#{id}
        ]]>
    </delete>

    <select id="selectOneRecord" resultMap="AlarmEntMap"
        parameterType="int"
    >
    
    <![CDATA[
            select * from AlarmEnt where ID=#{id}
        ]]>
    </select>
    

    <!-- 条件查询,得到全部记录 -->
    <select id="selectList" resultMap="AlarmEntMap">
    <![CDATA[
            select * from AlarmEnt
        ]]>
    </select>

    <!-- 条件查询,得到多条记录 -->
    <select id="selectListByWhere" resultMap="AlarmEntMap"
        parameterType="java.util.HashMap"
    >
        select * from AlarmEnt
         <where>
            <if test="EnergyID != null and EnergyID != '' ">AND ID LIKE '%'+#{id}+'%'</if>
        </where>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
    </select>

    <resultMap type="AlarmEnt" id="Energy0ValueEditMap"
        extends="AlarmEntMap"
    >
        <association property="way"
            resultMap="sbzy.enterpriseems.model.domain.EnergyValue.AlarmEntMap"
            columnPrefix="way_"/>
    </resultMap>

    <sql id="allColumnsWithAliases">
        ${tableAlias}.ID as ${columnPrefix}ID,
        ${tableAlias}.EnergyID as ${columnPrefix}EnergyID,
        ${tableAlias}.StartDate as ${columnPrefix}StartDate,
        ${tableAlias}.EndDate as ${columnPrefix}EndDate,
         ${tableAlias}.StandardDegree as ${columnPrefix}StandardDegree
    </sql>

    <sql id="selectForEditPage">
        SELECT
        <bind name="tableAlias" value="'T'" />
        <bind name="columnPrefix" value="''" />
        <include refid="allColumnsWithAliases"></include>,
        
        <bind name="tableAlias" value="'W'" />
        <bind name="columnPrefix" value="'way_'" />
        <include refid="sbzy.enterpriseems.model.domain.EnergyValue.allColumnsWithAliases"></include>
        FROM
        EnergyValue T LEFT OUTER
        JOIN
        EntEnergy W on
        T.EnergyID = W.ID
    </sql>

    <select id="selectOneForEditPage" resultMap="AlarmEntMap">
        <include refid="selectForEditPage"></include>
        WHERE
        T.ID=#{ID}
    </select>

    <select id="selectListForEditPage" resultMap="AlarmEntMap"
        parameterType="java.util.HashMap"
    >
        <include refid="selectForEditPage"></include>
        <where>
            <if test="name != null and name != ''">T.name LIKE '%'+#{name}+'%'</if>
        </where>
    </select>
</mapper>